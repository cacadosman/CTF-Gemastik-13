## Judul Soal
CDLL

## Deskripsi Soal
Circular Doubly Linked List (CDLL) merupakan gabuangan antara doubly linked list dan circular linked list<br>
Author : flammenwerfer

## Hint Soal
- UAF
- pointer apa saja yang ada di main_arena?

## Penjelasan Singkat Soal
Soal ini merupakan program untuk membuat Circular Doubly Linked List. Terdabat bug Use After Free dimana setelah node terakhir dihapus, pointer `CurrentNode` tidak diset menjadi NULL. Eksploitasi program ini bertujuan untuk memanggil remote shell.

Pertama-tama, kita lakukan leak libc address dengan memenuhi list unsorted bin sehingga libc address akan ditulis di memori heap. Buat 8 node dengan ukuran data 0x60 (agar ukuran chunk heap lebih dari 0x80), kemudian hapus semua node. Address libc akan ditampilkan pada nama dari `CurrentNode`.

Selanjutnya, pemanggilan remote shell dapat dilakukan dengan mengoverwrite `__free_hook` dengan address `system` dan kemudian menghapus node yang diberi nama `/bin/sh`. Hal ini akan menyebabkan pemanggilan `system("/bin/sh")` yang akan memunculkan remote shell. Variabel `__free_hook` dapat dioverwrite menggunakan teknik tchace poisoning dengan mengoverwrite pointer `bk` atau `fd` pada chunk heap yang telah di-free. Teknik tersebut dapat dilakukan dengan memanfaatkan pointer `next` pada `CurrentNode` yang masih berisi address libc yang menunjuk `main_arena`.
```
0x7fee14be3ca0 <main_arena+96>:		0x0000560f1833a6d0	0x0000000000000000
0x7fee14be3cb0 <main_arena+112>:	0x0000560f1833a250	0x0000560f1833a250
0x7fee14be3cc0 <main_arena+128>:	0x00007fee14be3cb0	0x00007fee14be3cb0
0x7fee14be3cd0 <main_arena+144>:	0x00007fee14be3cc0	0x00007fee14be3cc0
0x7fee14be3ce0 <main_arena+160>:	0x00007fee14be3cd0	0x00007fee14be3cd0
0x7fee14be3cf0 <main_arena+176>:	0x00007fee14be3ce0	0x00007fee14be3ce0
0x7fee14be3d00 <main_arena+192>:	0x00007fee14be3cf0	0x00007fee14be3cf0
0x7fee14be3d10 <main_arena+208>:	0x00007fee14be3d00	0x00007fee14be3d00
0x7fee14be3d20 <main_arena+224>:	0x00007fee14be3d10	0x00007fee14be3d10
```

Ketika memilih menu `Go to next node`, pointer `CurrentNode` akan menunjuk ke `main_arena` seperti potongan memori di atas. `main_arena+96` menunjuk ke top chuck dan `main_arena+112` menunjuk ke chunk terakhir yang di-free. `main_arena+112` merupakan tempat pointer prev pada struct node sehingga jika kita memilih menu `Go to prev node`, `CurrentNode` akan menunjuk node terakhir yang dihapus. Namun, address heap pada `main_arena` tersebut menunjuk ke `prev_size` dari chunk, bukan data pada chunk. Pointer `CurrentNode` akan menjadi seperti potongan memori di bawah.
```
0x560f1833a250:	0x0000000000000000	0x0000000000000091
0x560f1833a260:	0x00007fee14be3ca0	0x00007fee14be3ca0
0x560f1833a270:	0x0000560f1833a260	0x0000000000000060
0x560f1833a280:	0x5252525252525252	0x5252525252525252
0x560f1833a290:	0x5252525252525252	0x5252525252525252
0x560f1833a2a0:	0x5252525252525252	0x5252525252525252
0x560f1833a2b0:	0x5252525252525252	0x5252525252525252
```

Pada node tersebut, ukuran data menjadi `0x00007fee14be3ca0` sehingga pada saat memilih menu `Edit current node data` kita dapat melakukan overflow pada heap dan mengoverwrite pointer `bk` atau `fd` pada chunck dibawah `CurrentNode` dengan address `__free_hook`. Selanjutnya, buat node baru sampai malloc mengembalikan address `__free_hook` dan buat node dengan nama address `system`. Terakhir, hapus node dengan nama `/bin/sh`.


## Catatan Deploy Soal
- Folder deploy soal di server terdapat pada folder `server`
- Peserta diberikan semua file dalam folder `peserta` (`CDLL` dan `libc-2.31.so`)
- Ubah port yang diinginkan untuk service soal pada file `docker-compose.yml`
- run `docker-compose build`
- Lalu tinggal `docker-compose up -d`

## Catatan Solver
Solver soal terdapat pada script python3 bernama `solver.py` dalam folder `solver` . Tinggal mengganti HOST dan PORT nya.