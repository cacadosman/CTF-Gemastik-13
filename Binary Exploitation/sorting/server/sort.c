// gcc sort.c -o sort -fstack-protector-all -pie -Wl,-z,relro,-z,now

#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<unistd.h>
#include<time.h>

void bubble_sort(int ctr, int number[]){
    int temp;
    for(int i=0; i < ctr-1; i++){
        for(int j=0; j < ctr-i-1; j++){
            if(number[j] > number[j+1]){
                temp = number[j];
                number[j] = number[j+1];
                number[j+1] = temp;
            }
        }
    }
}

void merge(int left, int mid, int right, int number[]){
    int n1 = mid-left+1;
    int n2 = right-mid;
    int number_left[n1], number_right[n2], i, j, k;
    for(i=0; i<n1; i++)
        number_left[i] = number[left+i];
    for(i=0; i<n2; i++)
        number_right[i] = number[mid+1+i];

    i = 0;
    j = 0;
    k = left;
    while(i < n1 && j < n2)
    {
        if(number_left[i] < number_right[j])
            number[k++] = number_left[i++];
        else
            number[k++] = number_right[j++];
    }
    while (i < n1)
    {
        number[k++] = number_left[i++];
    }
    
    while (j < n2)
    {
        number[k++] = number_right[j++];
    }
}

void merge_sort(int left, int right, int number[]){
    if(left < right){
        int mid = left + (right-left) / 2;

        merge_sort(left, mid, number);
        merge_sort(mid+1, right, number);
        merge(left, mid, right, number);
    }
}

int is_sorted(int ctr, int number[]){
    for(int i=0; i<ctr-1; i++){
        if(number[i] > number[i+1]){
            return 0;
        }
    }
    return 1;
}

void bogo_sort(int ctr, int number[]){
    int r, temp;
    while(!is_sorted(ctr, number))
    {
        for(int i=0; i<ctr; i++){
            r = rand()%ctr;
            temp = number[r];
            number[r] = number[i];
            number[i] = temp;
        }
    }
}

int insert_number(int number[]){
    char s[0x400], *n;
    int ctr=0;
    memset(s, 0, 0x400);
    fgets(s, 0x400, stdin);

    n = strtok(s, " ");
    while(n)
    {
        number[ctr++] = atoi(n);
        n = strtok(NULL, " ");
    }
    return ctr;
}

void print_result(int ctr, int number[], __clock_t start, __clock_t stop){
    puts("\nSorted number :");
    for(int i=0; i<ctr; i++){
        printf("%d ", number[i]);
    }
    printf("\nTotal sort time : %.6f s\n\n", (double) (stop-start) / CLOCKS_PER_SEC);
}

void menu(){
    puts("[1] Bubble Sort");
    puts("[2] Merge Sort");
    puts("[3] Bogo Sort");
    printf("> ");
}

void init(){
    setvbuf(stdin, 0, 2, 0);
    setvbuf(stdout, 0, 2, 0);
    srand(time(NULL));
}

int main(){
    __clock_t start, stop;
    unsigned char ch = 'n';
    int choice = 0, ctr = 0;
    int number[30];

    init();
    while (ch == 'n' || ch == 'N')
    {
        puts("\nInsert number (max 30) :");
        ctr = insert_number(number);
        do{
            menu();
            choice = getchar();
            getchar();
            switch (choice)
            {
            case '1':
                start = clock();
                bubble_sort(ctr, number);
                stop = clock();
                print_result(ctr, number, start, stop);
                break;

            case '2':
                start = clock();
                merge_sort(0, ctr, number);
                stop = clock();
                print_result(ctr, number, start, stop);
                break;
            
            case '3':
                start = clock();
                bogo_sort(ctr, number);
                stop = clock();
                print_result(ctr, number, start, stop);
                break;

            default:
                puts("Invalid choice!\n");
                break;
            }
        }while(!(choice == '1' || choice == '2' || choice == '3'));
        printf("Exit? [y/n] > ");
        ch = getchar();
        getchar();
    }
    return 0;
}