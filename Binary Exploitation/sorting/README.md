## Judul Soal
Sorting

## Deskripsi Soal
Algoritma sorting mana yang paling cepat? <br>
Author : flammenwerfer

## Penjelasan Singkat Soal
Soal ini merupakan program untuk melihat runtime dalam mengurutkan bilangan dari tiga algoritma sorting. Eksploitasi program ini bertujuan untuk memanggil remote shell.

Terdapat dua bug dalam soal ini. Pertama, pada fungsi `insert_number` terdapat bug buffer overflow dimana array tidak diberikan batasan input.
```
int insert_number(int a1[]){
  v4 = 0;
  memset(&s, 0, 0x400uLL);
  fgets(&s, 1024, stdin);
  for ( nptr = strtok(&s, " "); nptr; nptr = strtok(0LL, " ") )
  {
    v1 = v4++;
    *(_DWORD *)(4LL * (signed int)v1 + a1) = atoi(nptr);
  }
  result = v4;
  return result;
}
```

Kedua, pada fungsi merge_sort dimana nilai yang diurutkan sebanyak jumlah input + 1. Karena fungsi `print_result` menampilkan angka urut sebanyak angka yang kita masukkan, maka jumlah angka yang ditampilkan tetap.
```
Insert number (max 30) :
1 2 3 4
[1] Bubble Sort
[2] Merge Sort
[3] Bogo Sort
> 2

Sorted number :
0 1 2 3 
Total sort time : 0.000003 s
```

Bug pada fungsi `merge_sort` dapat digunakan untuk melakukan leak nilai canary dan address libc. Leak dilakukan dari address stack terkecil ke terbesar. Karena array bertipe integer dan program bertipe 64bit, maka leak nilai di memori dilakukan dua kali, yang pertama untuk 4 byte LSB dan yang kedua 4 byte MSB. Agar nilai leak ditampilkan pada fungsi `print_result`, kita dapat memasukan nilai signed integer terbesar (2147483647) sehingga nilai leak berada pada posisi pertama.

Selanjutnya, karena program mengurutkan bilangan terlebih dahulu sebelum berakhir, maka overwrite return address dilakukan dengan memasukan nilai signed integer paling kecil (-2147483648) agar nilai yang akan dioverwrite berada di paling bawah atau memasukkan nilai yang sama agar nilai urut tidak berubah. overwrite nilai memori dilakukan dari address stack terbesar ke terkecil.

Return address pada fungsi main diganti dengan gadget yang akan memanggil `system("/bin/sh")`. Gadget `pop rdi` dapat diperoleh dari libc.


## Catatan Deploy Soal
- Folder deploy soal di server terdapat pada folder `server`
- Peserta diberikan semua file dalam folder `peserta` (`sort` dan `libc-2.31.so`)
- Ubah port yang diinginkan untuk service soal pada file `docker-compose.yml`
- run `docker-compose build`
- Lalu tinggal `docker-compose up -d`

## Catatan Solver
Solver soal terdapat pada script python3 bernama `solver.py` dalam folder `solver` . Tinggal mengganti HOST dan PORT nya.